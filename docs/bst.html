<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <title>Binary Search Tree</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://unpkg.com/@hpcc-js/wasm@0.3.11/dist/index.min.js"></script>
  <script src="https://unpkg.com/d3-graphviz@3.0.5/build/d3-graphviz.js"></script>
</head>
<body>
    <input type="text" name="" id="insert">
    <button id="insert" onclick="onInsert()">insert</button>
    <div id="graph" style="text-align: center;"></div>

<script>

  var bst = new BSTree(); 

  function onInsert(argument) {
    var input = document.querySelector("#insert").value;
    var key = parseInt(input)
    bst.insert(key);

    var s = graphviz(bst.root);

    d3.select("#graph")
      .graphviz()
        .renderDot(s);
  }




  function TreeNode(val) {
    this.val = val;
    this.left = null;
    this.right = null;
  }

  function insertDFS(node, key) {
    if (node == null){
        return new TreeNode(key);
    }
    if (key < node.val){
        node.left = insertDFS(node.left, key)
    } else if (node.val < key) {
        node.right = insertDFS(node.right, key)
    } else {
        node.val = key
    }
    return node;
  }

  function BSTree(){
    this.root = null;
    this.insert = function (key) {
        if (this.root == null){
            this.root = new TreeNode(key);
        } else {
            this.root = insertDFS(this.root, key)
        }
    }
  }


  function graphviz(root){
    if (root === null) {
      return
    };

    var seq = 0;
    var queue = [[root, seq]];

    var lines = [];
      lines.push('digraph g {')
      lines.push('node [shape=record, height=.1];')
      lines.push('node' + seq + '[label="<f0> |' + root.val + '| <f1>"];')

    while (queue.length > 0){
      var size = queue.length;
      for (var i = 0; i < size; i++){
        var item = queue.shift()
        var node = item[0];
        var seq = item[1];
        
        if (node.left != null){
          var lseq = 2 * seq + 1
          queue.push([node.left, lseq])
          lines.push('node' + lseq + '[label="<f0> |' + node.left.val + '| <f1>"];');
          lines.push('node' + seq + ':f0 -> node' + lseq + ';');
        }

        if (node.right != null){
          var rseq = 2 * seq + 2
          queue.push([node.right, rseq])
          lines.push('node' + rseq + '[label="<f0> |' + node.right.val + '| <f1>"];');
          lines.push('node' + seq + ':f1 -> node' + rseq + ';');
        }
      }
    }
    lines.push('}');
    return lines.join('\n');
  }


</script>
</body>